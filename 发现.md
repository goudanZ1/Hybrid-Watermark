加入RINGID有时经常会导致图片中央出现圆环
![alt text](image.png)

## Variant 说明

- chacha / nochacha: 是否启用 ChaCha20 加密
- gs02: GS 通道 [0,2]
- gs03: GS 通道 [0,3]
- gs023: GS 通道 [0,2,3]
- rd13: RingID 通道 [1,3]
- rd12: RingID 通道 [1,2]
- rd1: RingID 通道 [1]

## 设计解读（参考项目技术总结）

- Gaussian Shading：通过截断正态采样保持分布一致性，依赖空间对齐与投票恢复，因此对旋转更敏感。
- RingID：在频域环形区域注入模式，依赖距离匹配，通常对模糊/缩放更稳，但可能引入中心环纹理。
- 混合策略：GS（空间域）+ RingID（频域）互补，单项指标需要分开看，避免混合分数掩盖问题。

## 实验说明

本次实验使用 `run_gaussian_shading_configurable.py`，固定 `num=100`，分别在五类扰动下评估混合水印的检测与追踪能力。扰动包括：

- GauNoise: `gaussian_std=0.05`
- MedBlur: `median_blur_k=7`
- Resize: `resize_ratio=0.25`
- Rotate: `rotate=75`
- SPNoise: `sp_prob=0.05`

每类扰动下对比 6 个 variant（chacha/nochacha x 3 种通道配置）。输出指标包括：

- `tpr_detection`: 检测成功率
- `tpr_traceability`: 追踪成功率
- `mean_gs_acc`: GS 通道恢复准确率均值
- `mean_ring_id_acc`: RingID 识别准确率均值

## 结果观察（趋势）

- **MedBlur / Resize** 下整体稳定，`tpr_detection` 与 `tpr_traceability` 接近 1，GS 准确率也较高。
- **Rotate=75** 明显更难，GS 准确率大幅下降（约 0.50 左右），检测与追踪也显著下滑，说明旋转对逆扩散恢复影响最大。
- **单 ring 通道（rd1）** 的 `mean_ring_id_acc` 相对偏低，且波动更大；多 ring 通道更稳定。
- **chacha vs nochacha** 在多数设置下差异不大，个别扰动下存在小幅波动，整体更可能是统计波动或配置差异导致。

## 实验设计说明

- 通过固定扰动强度与样本量，隔离比较 **通道配置** 与 **是否启用 ChaCha** 的影响。
- GS 与 RingID 在不同通道分配下并行注入，便于观察通道分配对鲁棒性与可追踪性的影响。
- 用 `tpr_detection` 与 `tpr_traceability` 作为主指标，补充 GS 与 RingID 的分项准确率，避免混合分数带来的可解释性问题。

## 实验结果汇总

**GauNoise (gaussian_std=0.05)**
| variant | tpr_det | tpr_trace | mean_gs_acc | mean_ring_id_acc |
| --- | --- | --- | --- | --- |
| chacha_gs02_rd13 | 0.920 | 0.890 | 0.881 +/- 0.121 | 0.830 +/- 0.378 |
| chacha_gs023_rd1 | 0.960 | 0.950 | 0.913 +/- 0.093 | 0.700 +/- 0.461 |
| chacha_gs03_rd12 | 0.880 | 0.850 | 0.857 +/- 0.127 | 0.800 +/- 0.402 |
| nochacha_gs02_rd13 | 0.930 | 0.890 | 0.888 +/- 0.111 | 0.830 +/- 0.378 |
| nochacha_gs023_rd1 | 0.970 | 0.930 | 0.905 +/- 0.106 | 0.720 +/- 0.451 |
| nochacha_gs03_rd12 | 0.840 | 0.780 | 0.845 +/- 0.127 | 0.790 +/- 0.409 |

**MedBlur (median_blur_k=7)**
| variant | tpr_det | tpr_trace | mean_gs_acc | mean_ring_id_acc |
| --- | --- | --- | --- | --- |
| chacha_gs02_rd13 | 0.990 | 0.980 | 0.933 +/- 0.113 | 0.950 +/- 0.219 |
| chacha_gs023_rd1 | 1.000 | 1.000 | 0.963 +/- 0.064 | 0.870 +/- 0.338 |
| chacha_gs03_rd12 | 1.000 | 0.980 | 0.902 +/- 0.141 | 0.980 +/- 0.141 |
| nochacha_gs02_rd13 | 1.000 | 0.970 | 0.928 +/- 0.121 | 0.950 +/- 0.219 |
| nochacha_gs023_rd1 | 1.000 | 0.980 | 0.957 +/- 0.084 | 0.870 +/- 0.338 |
| nochacha_gs03_rd12 | 0.980 | 0.950 | 0.898 +/- 0.126 | 0.920 +/- 0.273 |

**Resize (resize_ratio=0.25)**
| variant | tpr_det | tpr_trace | mean_gs_acc | mean_ring_id_acc |
| --- | --- | --- | --- | --- |
| chacha_gs02_rd13 | 0.980 | 0.970 | 0.921 +/- 0.114 | 0.940 +/- 0.239 |
| chacha_gs023_rd1 | 1.000 | 0.990 | 0.953 +/- 0.070 | 0.890 +/- 0.314 |
| chacha_gs03_rd12 | 0.980 | 0.950 | 0.886 +/- 0.145 | 0.960 +/- 0.197 |
| nochacha_gs02_rd13 | 0.990 | 0.940 | 0.913 +/- 0.130 | 0.920 +/- 0.273 |
| nochacha_gs023_rd1 | 0.990 | 0.960 | 0.948 +/- 0.088 | 0.850 +/- 0.359 |
| nochacha_gs03_rd12 | 0.980 | 0.920 | 0.871 +/- 0.129 | 0.930 +/- 0.256 |

**Rotate (rotate=75)**
| variant | tpr_det | tpr_trace | mean_gs_acc | mean_ring_id_acc |
| --- | --- | --- | --- | --- |
| chacha_gs02_rd13 | 0.870 | 0.750 | 0.509 +/- 0.045 | 0.840 +/- 0.368 |
| chacha_gs023_rd1 | 0.700 | 0.560 | 0.503 +/- 0.037 | 0.690 +/- 0.465 |
| chacha_gs03_rd12 | 0.850 | 0.820 | 0.510 +/- 0.044 | 0.940 +/- 0.239 |
| nochacha_gs02_rd13 | 0.920 | 0.780 | 0.502 +/- 0.042 | 0.810 +/- 0.394 |
| nochacha_gs023_rd1 | 0.790 | 0.610 | 0.505 +/- 0.037 | 0.710 +/- 0.456 |
| nochacha_gs03_rd12 | 0.840 | 0.790 | 0.509 +/- 0.046 | 0.900 +/- 0.302 |

**SPNoise (sp_prob=0.05)**
| variant | tpr_det | tpr_trace | mean_gs_acc | mean_ring_id_acc |
| --- | --- | --- | --- | --- |
| chacha_gs02_rd13 | 0.810 | 0.760 | 0.810 +/- 0.110 | 0.840 +/- 0.368 |
| chacha_gs023_rd1 | 0.950 | 0.930 | 0.857 +/- 0.094 | 0.720 +/- 0.451 |
| chacha_gs03_rd12 | 0.790 | 0.720 | 0.808 +/- 0.114 | 0.870 +/- 0.338 |
| nochacha_gs02_rd13 | 0.820 | 0.750 | 0.811 +/- 0.115 | 0.820 +/- 0.386 |
| nochacha_gs023_rd1 | 0.940 | 0.910 | 0.853 +/- 0.102 | 0.640 +/- 0.482 |
| nochacha_gs03_rd12 | 0.780 | 0.690 | 0.797 +/- 0.115 | 0.830 +/- 0.378 |
